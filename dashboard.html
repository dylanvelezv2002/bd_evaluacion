<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sala Situacional | Gesti贸n de Riesgos</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root {
            --primary: #0f172a; --secondary: #334155; --accent: #2563eb;
            --bg: #f8fafc; --card: #ffffff;
            --success: #059669; --warning: #d97706; --danger: #dc2626;
        }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--primary); font-size: 0.9rem; }

        /* PRELOADER */
        #preloader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #ffffff; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .loader-spinner {
            width: 50px; height: 50px; border: 4px solid #e2e8f0;
            border-top: 4px solid var(--accent); border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* UI COMPONENTS */
        .navbar { background: var(--card); border-bottom: 1px solid #e2e8f0; padding: 12px 24px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .brand-text { font-weight: 800; letter-spacing: -0.5px; color: var(--primary); font-size: 1.1rem; }
        
        .tech-card {
            background: var(--card); border: 1px solid #e2e8f0; border-radius: 8px;
            padding: 20px; margin-bottom: 20px; box-shadow: 0 1px 2px rgba(0,0,0,0.03);
            height: 100%; display: flex; flex-direction: column;
        }
        
        .kpi-value { font-size: 2rem; font-weight: 800; line-height: 1; letter-spacing: -1px; }
        .kpi-label { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; color: #64748b; letter-spacing: 0.5px; margin-bottom: 5px; }

        /* ANLISIS TCNICO (TEXTO PROFESIONAL) */
        .ai-analysis-box {
            background-color: #f1f5f9; border-left: 4px solid var(--accent);
            padding: 15px; font-size: 0.85rem; color: #334155; margin-top: 15px;
            border-radius: 0 6px 6px 0; line-height: 1.5;
            text-align: justify;
        }
        .ai-label { font-size: 0.65rem; font-weight: 800; color: var(--accent); text-transform: uppercase; display: block; margin-bottom: 6px; }

        /* MAPA */
        #map { height: 350px; width: 100%; border-radius: 6px; z-index: 1; border: 1px solid #e2e8f0; }

        /* MONITOR TERRITORIAL */
        .territory-item {
            padding: 10px; border-bottom: 1px solid #f1f5f9; cursor: pointer; transition: all 0.2s;
            border-left: 4px solid transparent;
        }
        .territory-item:hover { background-color: #f8fafc; padding-left: 15px; }
        .t-score { font-weight: 800; float: right; }

        /* ESTADOS */
        .border-success { border-left-color: var(--success) !important; }
        .border-warning { border-left-color: var(--warning) !important; }
        .border-danger { border-left-color: var(--danger) !important; }
        .text-success { color: var(--success) !important; }
        .text-warning { color: var(--warning) !important; }
        .text-danger { color: var(--danger) !important; }

        @media print {
            .no-print { display: none !important; }
            .tech-card { border: 1px solid #ddd; break-inside: avoid; box-shadow: none; }
            body { background: white; font-size: 11px; }
            .ai-analysis-box { background: #f9f9f9 !important; border-left-color: #000 !important; }
            #map { height: 250px; } /* Mapa m谩s peque帽o al imprimir */
        }
    </style>
</head>
<body>

    <div id="preloader">
        <div class="loader-spinner"></div>
        <h6 class="fw-bold text-secondary">Procesando Informaci贸n Geoespacial...</h6>
        <small class="text-muted">Conectando con Base de Datos UEB-GAD</small>
    </div>

    <nav class="navbar fixed-top no-print">
        <div class="container-fluid">
            <div class="d-flex align-items-center gap-3">
                <span class="brand-text"><i class="bi bi-grid-1x2-fill text-primary me-2"></i>SALA SITUACIONAL</span>
                <select id="parroquiaFilter" class="form-select form-select-sm" style="width: 200px; font-weight:600;" onchange="applyFilter()">
                    <option value="ALL"> Provincia Completa</option>
                    </select>
            </div>
            <div class="d-flex gap-2">
                <button onclick="window.print()" class="btn btn-primary btn-sm fw-bold"><i class="bi bi-printer"></i> Reporte PDF</button>
                <button onclick="location.reload()" class="btn btn-outline-secondary btn-sm"><i class="bi bi-arrow-clockwise"></i></button>
            </div>
        </div>
    </nav>

    <div class="container-fluid px-4" style="margin-top: 80px; max-width: 1600px;">
        
        <div class="d-flex justify-content-between align-items-end mb-4 border-bottom pb-3">
            <div>
                <h5 class="fw-bold text-secondary m-0">INFORME TCNICO DE GESTIN DE RIESGOS</h5>
                <h3 class="fw-bold text-primary m-0" id="reportTitle">Consolidado Provincial</h3>
            </div>
            <div class="text-end">
                <div class="badge bg-primary mb-1">PILOTO VINCULACIN 2025</div>
                <div class="small fw-bold text-muted">Fecha de Corte: <script>document.write(new Date().toLocaleDateString())</script></div>
            </div>
        </div>

        <div class="row g-3 mb-4">
            <div class="col-md-3">
                <div class="tech-card align-items-center justify-content-center py-4">
                    <div class="kpi-label">Puntos Evaluados</div>
                    <div class="kpi-value" id="kpiTotal">0</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="tech-card align-items-center justify-content-center py-4">
                    <div class="kpi-label">ndice de Resiliencia (1-5)</div>
                    <div class="kpi-value text-primary" id="kpiPromedio">0.0</div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="tech-card flex-row align-items-center justify-content-between px-5 py-3">
                    <div>
                        <div class="kpi-label">Diagn贸stico Situacional</div>
                        <div class="fw-bold text-uppercase" id="kpiEstado" style="font-size: 1.5rem">-</div>
                    </div>
                    <i class="bi bi-activity fs-1 opacity-25"></i>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-8">
                <div class="tech-card p-0 mb-4 overflow-hidden">
                    <div class="p-3 border-bottom bg-light d-flex justify-content-between">
                        <h6 class="fw-bold m-0 text-primary"><i class="bi bi-geo-alt-fill me-2"></i>DISTRIBUCIN GEESPACIAL DE CAPACIDADES</h6>
                    </div>
                    <div id="map"></div>
                </div>

                <h6 class="text-primary fw-bold mb-3 border-bottom pb-2">ANLISIS ESTRUCTURAL POR INDICADOR</h6>
                <div class="row" id="chartsGrid">
                    </div>
            </div>

            <div class="col-lg-4">
                
                <div class="tech-card mb-3">
                    <h6 class="kpi-label mb-3">PERFIL DE COMPETENCIAS</h6>
                    <div style="height: 250px;">
                        <canvas id="radarChart"></canvas>
                    </div>
                    <div class="ai-analysis-box mt-2" style="border-left-color: #0f172a;">
                        <span class="ai-label" style="color:#0f172a">SNTESIS DEL PERFIL:</span>
                        <span id="radarAnalysisText">Calculando...</span>
                    </div>
                </div>

                <div class="tech-card mb-3 p-0 overflow-hidden">
                    <div class="p-3 bg-light border-bottom">
                        <h6 class="fw-bold m-0 text-secondary" style="font-size:0.8rem">MONITOR TERRITORIAL</h6>
                    </div>
                    <div id="territoryGrid" style="max-height: 300px; overflow-y: auto;">
                        </div>
                </div>

                <div class="tech-card p-0 overflow-hidden">
                    <div class="p-3 bg-light border-bottom">
                        <h6 class="fw-bold m-0 text-secondary" style="font-size:0.8rem">REGISTRO DE ACTORES</h6>
                    </div>
                    <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                        <table class="table table-sm table-hover mb-0" style="font-size:0.75rem">
                            <thead class="table-light"><tr><th>Parroquia</th><th>Cargo</th><th>Nota</th></tr></thead>
                            <tbody id="tableBody"></tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // ==========================================================
        // 锔 TU URL DE GOOGLE APPS SCRIPT
        // ==========================================================
        const API_URL = "https://script.google.com/macros/s/AKfycbzY6lu7YA6rpHihQPY8vjwlxdMg32g3Ezii10aAlPdG2h6BlFWBdLmnYeD_rI5jtM3B/exec";

        // VARIABLES GLOBALES
        let RAW_DATA = [];
        let FILTERED_DATA = [];
        let map;
        let markersLayer = new L.LayerGroup(); // Capa para borrar y poner marcadores
        let chartInstances = {};

        // --- MOTOR DE ANLISIS TCNICO PROFESIONAL (TEXTOS LARGOS) ---
        const techAnalysisDB = {
            p1: { // Participaci贸n
                low: ["Se evidencia una fractura en el tejido social. La convocatoria no logr贸 superar el umbral m铆nimo de representatividad, lo que deslegitima la toma de decisiones en esta fase inicial. Se recomienda replantear la estrategia de acercamiento comunitario.", "Ausentismo cr铆tico. La falta de qu贸rum impide la validaci贸n de los estatutos del comit茅. Es imperativo realizar un mapeo de actores clave previo a una segunda convocatoria para garantizar la movilizaci贸n social."],
                mid: ["Participaci贸n sectorizada. Si bien existe asistencia, se observa la ausencia de grupos vulnerables o sectores perif茅ricos de la comunidad. La representatividad es parcial y requiere medidas correctivas de inclusi贸n.", "Nivel de convocatoria regular. El proceso cuenta con validaci贸n b谩sica, pero carece de la masa cr铆tica necesaria para garantizar la sostenibilidad operativa del comit茅 a largo plazo."],
                high: ["Alta cohesi贸n social detectada. La masiva concurrencia valida plenamente el proceso de conformaci贸n, otorgando una fuerte legitimidad de origen a la directiva electa. Escenario 贸ptimo para la implementaci贸n del plan.", "Excelente poder de convocatoria. La comunidad demuestra inter茅s activo en la gesti贸n de riesgos, lo que constituye el principal activo intangible para la resiliencia local."]
            },
            p2: { // Compromiso
                low: ["Fragilidad institucional en la directiva. Se percibe apat铆a y desconocimiento de funciones, lo que eleva el riesgo de acefal铆a o abandono del comit茅 en el corto plazo. Se requiere intervenci贸n motivacional urgente.", "Liderazgo inexistente. Los miembros electos asumieron los cargos por presi贸n social y no por convicci贸n, lo que augura una nula operatividad ante emergencias reales."],
                mid: ["Compromiso condicionado. La directiva muestra voluntad pol铆tica pero carece de autonom铆a. Su funcionamiento depender谩 estrictamente del acompa帽amiento t茅cnico externo constante.", "Liderazgo en desarrollo. Existe inter茅s, pero se detectan dudas sobre el alcance de sus responsabilidades legales y operativas. Se sugiere un programa de mentor铆a."],
                high: ["Gobernanza local fortalecida. La directiva exhibe proactividad y empoderamiento de sus roles. Este liderazgo aut贸nomo es un indicador clave de sostenibilidad del proyecto piloto.", "Alto nivel de compromiso c铆vico. Los l铆deres identifican claramente su rol como primeros respondientes y gestores de su territorio."]
            },
            p3: { // Capacitaci贸n
                low: ["Brecha cognitiva cr铆tica. La evaluaci贸n post-taller indica que los conceptos de autoprotecci贸n no fueron asimilados. La comunidad sigue siendo vulnerable por desconocimiento de protocolos b谩sicos.", "Falla en la transferencia de conocimientos. La metodolog铆a pedag贸gica no fue adecuada para el perfil demogr谩fico, resultando en confusi贸n conceptual generalizada."],
                mid: ["Asimilaci贸n te贸rica sin anclaje pr谩ctico. Los participantes comprenden los riesgos, pero muestran inseguridad al aplicar los protocolos de respuesta. Se requiere reforzar con simulacros de escritorio.", "Competencias b谩sicas adquiridas. El nivel de conocimiento es suficiente para una primera respuesta, pero insuficiente para la gesti贸n integral de escenarios complejos."],
                high: ["Apropiaci贸n efectiva del conocimiento. La comunidad demuestra dominio de los protocolos de autoprotecci贸n y capacidad para replicar la informaci贸n a sus n煤cleos familiares.", "Capacidades instaladas con 茅xito. El proceso de ense帽anza-aprendizaje logr贸 modificar la percepci贸n del riesgo y establecer conductas preventivas claras."]
            },
            p4: { // Plan
                low: ["Resistencia cultural al planeamiento. La comunidad percibe el Plan Comunitario como un requisito burocr谩tico ex贸geno y no como una herramienta propia de supervivencia.", "Falta de validaci贸n social del instrumento. El Plan elaborado carece de aportes sustanciales de la base, lo que garantiza su inoperancia al momento de una crisis real."],
                mid: ["Validaci贸n formal del instrumento. El Plan ha sido aprobado, pero existe escepticismo sobre su viabilidad financiera y operativa sin el apoyo subsidiario del GAD.", "Planificaci贸n reactiva. El documento se enfoca en la respuesta, pero descuida las fases de prevenci贸n y mitigaci贸n. Requiere revisi贸n t茅cnica para ser integral."],
                high: ["Instrumento de gesti贸n validado. El Plan Comunitario es reconocido por los actores locales como la hoja de ruta oficial para la reducci贸n de riesgos en su territorio.", "Planificaci贸n participativa exitosa. La construcci贸n colectiva del documento asegura su aplicabilidad y respeto por parte de todos los sectores de la comunidad."]
            },
            // ... Se aplica la misma l贸gica a las otras preguntas ...
            generic: {
                low: ["Indicador en estado cr铆tico. Representa un punto de falla sist茅mico que compromete la viabilidad del proyecto en esta zona. Requiere medidas correctivas inmediatas.", "Deficiencia estructural detectada. Los resultados sugieren que el modelo de intervenci贸n actual no es efectivo para las condiciones locales."],
                mid: ["Desempe帽o est谩ndar con oportunidades de mejora. El indicador es funcional pero no 贸ptimo; se deben ajustar los procesos para elevar el est谩ndar de calidad.", "Estabilidad operativa parcial. Si bien no existen riesgos inminentes, la falta de consolidaci贸n en este aspecto podr铆a generar problemas futuros."],
                high: ["Fortaleza estrat茅gica consolidada. Este indicador supera los est谩ndares previstos y debe documentarse como caso de 茅xito para su r茅plica en otras parroquias.", "Excelente desempe帽o t茅cnico. La gesti贸n en este componente demuestra madurez y sostenibilidad, garantizando resultados a largo plazo."]
            }
        };

        const labels = [
            "1. Participaci贸n", "2. Compromiso Directiva", "3. Capacitaci贸n", "4. Plan Comunitario",
            "5. Comunicaci贸n", "6. Articulaci贸n Inst.", "7. Inclusi贸n Social", "8. Potencial R茅plica"
        ];

        // INICIO
        window.onload = () => {
            initMap();
            fetch(API_URL)
                .then(res => res.json())
                .then(response => {
                    document.getElementById('preloader').style.display = 'none';
                    if(response.data) {
                        RAW_DATA = response.data;
                        initFilters();
                        applyFilter(); // Carga inicial
                    }
                })
                .catch(err => { console.error(err); alert("Error de conexi贸n"); });
        };

        // --- 1. MAPA & FILTROS ---
        function initMap() {
            map = L.map('map').setView([-0.2530, -79.1754], 10);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '漏 OpenStreetMap contributors'
            }).addTo(map);
            markersLayer.addTo(map);
        }

        function initFilters() {
            const select = document.getElementById('parroquiaFilter');
            const parroquias = [...new Set(RAW_DATA.map(row => row[1]))].sort();
            parroquias.forEach(p => {
                if(p) {
                    const opt = document.createElement('option');
                    opt.value = p; opt.text = ` ${p}`;
                    select.appendChild(opt);
                }
            });
        }

        function applyFilter() {
            const selected = document.getElementById('parroquiaFilter').value;
            
            if (selected === 'ALL') {
                FILTERED_DATA = RAW_DATA;
                document.getElementById('reportTitle').innerText = "Consolidado Provincial";
                map.setView([-0.2530, -79.1754], 10);
            } else {
                FILTERED_DATA = RAW_DATA.filter(row => row[1] === selected);
                document.getElementById('reportTitle').innerText = `Reporte: ${selected}`;
                // Centrar mapa en el primer punto filtrado si existe
                if(FILTERED_DATA.length > 0 && FILTERED_DATA[0][5]) {
                    map.setView([FILTERED_DATA[0][5], FILTERED_DATA[0][6]], 13);
                }
            }
            updateDashboard();
        }

        // --- 2. DASHBOARD LOGIC ---
        function updateDashboard() {
            const total = FILTERED_DATA.length;
            if(total === 0) return;

            // A. MAPA: Limpiar y Poner Marcadores
            markersLayer.clearLayers();
            FILTERED_DATA.forEach(row => {
                // ndices (ajustados por Lat/Lng): 
                // 0:Fecha, 1:Parr, 2:Com, 3:Nom, 4:Cargo, 5:Lat, 6:Lng, 7...Preguntas
                const lat = row[5];
                const lng = row[6];
                
                // Calcular nota promedio de la fila
                let sum = 0; for(let i=0; i<8; i++) sum += Number(row[i+7]);
                let avg = sum/8;

                let color = avg >= 4 ? '#059669' : (avg >= 3 ? '#d97706' : '#dc2626');

                if(lat && lng) {
                    L.circleMarker([lat, lng], {
                        radius: 8, fillColor: color, color: "#fff", weight: 2, fillOpacity: 0.9
                    }).bindPopup(`<b>${row[2]}</b><br>${row[4]}<br>Nota: ${avg.toFixed(1)}`).addTo(markersLayer);
                }
            });

            // B. CLCULOS MATEMTICOS
            let sums = new Array(8).fill(0);
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = "";

            FILTERED_DATA.forEach(row => {
                let rowAvg = 0;
                for(let i=0; i<8; i++) {
                    let val = Number(row[i+7]);
                    sums[i] += val;
                    rowAvg += val;
                }
                rowAvg = (rowAvg/8).toFixed(1);
                tbody.innerHTML += `<tr><td>${row[1]}</td><td>${row[4]}</td><td><b>${rowAvg}</b></td></tr>`;
            });

            const avgs = sums.map(s => (s/total).toFixed(1));
            const globalAvg = (avgs.reduce((a,b)=>parseFloat(a)+parseFloat(b),0)/8).toFixed(1);

            // C. KPIs UI
            document.getElementById('kpiTotal').innerText = total;
            document.getElementById('kpiPromedio').innerText = globalAvg;
            const kpiState = document.getElementById('kpiEstado');
            
            if(globalAvg >= 4) { kpiState.innerText = "RESILIENTE"; kpiState.className = "fw-bold text-success"; }
            else if(globalAvg >= 3) { kpiState.innerText = "VULNERABLE"; kpiState.className = "fw-bold text-warning"; }
            else { kpiState.innerText = "CRTICO"; kpiState.className = "fw-bold text-danger"; }

            // D. RENDERIZAR TODO
            renderCharts(avgs);
            renderRadar(avgs);
            renderTerritoryMonitor();
        }

        // --- 3. GENERADOR DE TEXTO TCNICO ---
        function getAnalysisText(key, score) {
            let level = score >= 4 ? 'high' : (score >= 3 ? 'mid' : 'low');
            let texts = techAnalysisDB[key] ? techAnalysisDB[key][level] : techAnalysisDB.generic[level];
            // Aleatoriedad para que no se vea repetitivo
            return texts[Math.floor(Math.random() * texts.length)];
        }

        function renderCharts(avgs) {
            const container = document.getElementById('chartsGrid');
            container.innerHTML = "";

            avgs.forEach((avg, i) => {
                const qKey = `p${i+1}`;
                const text = getAnalysisText(qKey, avg);
                const color = avg >= 4 ? '#059669' : (avg >= 3 ? '#d97706' : '#dc2626');
                const canvasId = `chart${i}`;

                if(chartInstances[canvasId]) chartInstances[canvasId].destroy();

                container.innerHTML += `
                    <div class="col-md-6 mb-3">
                        <div class="tech-card p-3 h-100">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="kpi-label m-0 text-dark">${labels[i]}</h6>
                                <span class="badge" style="background:${color}">${avg}</span>
                            </div>
                            <div style="height: 60px;">
                                <canvas id="${canvasId}"></canvas>
                            </div>
                            <div class="ai-analysis-box">
                                <span class="ai-label">DICTAMEN TCNICO:</span>
                                ${text}
                            </div>
                        </div>
                    </div>
                `;

                setTimeout(() => {
                    const ctx = document.getElementById(canvasId).getContext('2d');
                    chartInstances[canvasId] = new Chart(ctx, {
                        type: 'bar',
                        data: { labels: [''], datasets: [{ data: [avg], backgroundColor: color, borderRadius: 4, barThickness: 20 }] },
                        options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, scales: { x: { min: 0, max: 5, display: false }, y: { display: false } }, plugins: { legend: { display: false } } }
                    });
                }, 0);
            });
        }

        function renderRadar(avgs) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            const canvasId = 'radarChart';
            if(chartInstances[canvasId]) chartInstances[canvasId].destroy();

            const globalAvg = avgs.reduce((a,b)=>parseFloat(a)+parseFloat(b),0)/8;
            const analysis = globalAvg > 3.5 ? 
                "El comit茅 presenta un perfil de competencias equilibrado, apto para la fase operativa." : 
                "Se detectan asimetr铆as cr铆ticas en la formaci贸n. No activar hasta subsanar brechas.";
            document.getElementById('radarAnalysisText').innerText = analysis;

            chartInstances[canvasId] = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels.map(l => l.split(". ")[1]),
                    datasets: [{ label: 'Nivel', data: avgs, backgroundColor: 'rgba(37, 99, 235, 0.2)', borderColor: '#2563eb', borderWidth: 2 }]
                },
                options: { scales: { r: { suggestedMin: 0, suggestedMax: 5, ticks: { display: false } } }, plugins: { legend: { display: false } }, maintainAspectRatio: false }
            });
        }

        function renderTerritoryMonitor() {
            const container = document.getElementById('territoryGrid');
            container.innerHTML = "";
            
            // Agrupar
            const groups = {};
            RAW_DATA.forEach(row => {
                const p = row[1];
                if(!groups[p]) groups[p] = { sum: 0, count: 0 };
                let rowSum = 0; for(let i=0; i<8; i++) rowSum += Number(row[i+7]);
                groups[p].sum += (rowSum/8);
                groups[p].count++;
            });

            for(const [p, d] of Object.entries(groups)) {
                if(!p) continue;
                const score = (d.sum/d.count).toFixed(1);
                let borderClass = score >= 4 ? 'border-success' : (score >= 3 ? 'border-warning' : 'border-danger');
                let textClass = score >= 4 ? 'text-success' : (score >= 3 ? 'text-warning' : 'text-danger');

                container.innerHTML += `
                    <div class="territory-item ${borderClass}" onclick="document.getElementById('parroquiaFilter').value='${p}'; applyFilter();">
                        <span class="fw-bold text-secondary">${p}</span>
                        <span class="t-score ${textClass}">${score}</span>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
